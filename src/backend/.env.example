# Environment Configuration
# Copy this file to .env and fill in the values

# Application
APP_NAME=TruePulse
APP_ENV=development
DEBUG=true
SECRET_KEY=your-secret-key-here-change-in-production

# Azure
AZURE_TENANT_ID=
AZURE_CLIENT_ID=
AZURE_KEY_VAULT_URL=https://your-keyvault.vault.azure.net/

# Database - PostgreSQL (User data)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=truepulse
POSTGRES_PASSWORD=your-password-here
POSTGRES_DB=truepulse

# Azure Storage (Tables for votes/tokens, Blobs for assets)
# For local dev, use connection string. In production, uses managed identity.
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=...;AccountKey=...;EndpointSuffix=core.windows.net
AZURE_STORAGE_TABLE_ENDPOINT=https://yourstorageaccount.table.core.windows.net/
AZURE_STORAGE_BLOB_ENDPOINT=https://yourstorageaccount.blob.core.windows.net/

# Azure OpenAI (Poll Generation)
# Either use managed identity (production) or API key (local dev)
AZURE_OPENAI_ENDPOINT=https://your-openai.openai.azure.com/
AZURE_OPENAI_API_KEY=your-api-key-here
AZURE_OPENAI_DEPLOYMENT=gpt-4o-mini

# Azure Communication Services (SMS)
# NOTE: Phone numbers must be purchased AFTER ACS is deployed
# See infra/README.md for post-deployment steps
AZURE_COMMUNICATION_SERVICE_NAME=acs-truepulse-xxxxxx
AZURE_COMMUNICATION_CONNECTION_STRING=endpoint=https://your-acs.communication.azure.com/;accesskey=...
AZURE_COMMUNICATION_SENDER_NUMBER=+1XXXXXXXXXX
SMS_VERIFICATION_CODE_EXPIRY_MINUTES=10

# Azure Email Communication Services (Email Verification)
# NOTE: Azure-managed domain is auto-provisioned, format: DoNotReply@xxxxxxxx.azurecomm.net
# For custom domains, see infra/README.md for DNS setup
AZURE_EMAIL_SERVICE_NAME=ecs-truepulse-xxxxxx
AZURE_EMAIL_SENDER_ADDRESS=DoNotReply@xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.azurecomm.net
EMAIL_VERIFICATION_CODE_EXPIRY_MINUTES=30

# News API Keys (for event aggregation)
# Get free keys from:
# - https://newsdata.io (500 calls/month)
# - https://newsapi.org (100 calls/day)
NEWSDATA_API_KEY=
NEWSAPI_ORG_API_KEY=

# Authentication
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS
CORS_ORIGINS=["http://localhost:3000","https://truepulse.io"]

# API Rate Limiting
RATE_LIMIT_PER_MINUTE=60

# Frontend-Only API Access
# IMPORTANT: Change FRONTEND_API_SECRET to a secure random value in production!
# This secret must match the frontend's NEXT_PUBLIC_FRONTEND_API_SECRET
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
FRONTEND_API_SECRET=
ALLOWED_ORIGINS=["http://localhost:3000","https://truepulse.io"]
ENFORCE_FRONTEND_ONLY=true

# Poll Configuration
# Polls rotate at the top of each hour (or configured interval)
POLL_DURATION_HOURS=1       # Duration of each poll in hours (1 = hourly rotation)
POLL_AUTO_GENERATE=true     # Automatically generate new polls from current events
POLL_TIMEZONE=UTC           # Timezone for poll scheduling

# Fraud Detection & Bot Prevention
# Device fingerprinting salt (generates unique device IDs)
FINGERPRINT_SALT=your-fingerprint-salt-change-in-production

# IP Intelligence APIs (for VPN/proxy/bot detection)
# IPInfo.io - 50k free requests/month - https://ipinfo.io/signup
IPINFO_TOKEN=
# AbuseIPDB - 1000 free checks/day - https://www.abuseipdb.com/account/api
ABUSEIPDB_KEY=

# Cloudflare Turnstile (privacy-friendly CAPTCHA)
# Create at https://dash.cloudflare.com/turnstile
TURNSTILE_SITE_KEY=
TURNSTILE_SECRET_KEY=

# =============================================================================
# VERIFICATION REQUIREMENTS - Primary Bot Farm Defense
# =============================================================================
# These are the most effective defenses against bot farms:
# - Phone numbers cost money and are hard to obtain at scale
# - Email + Phone together = multiplicative difficulty for attackers

# Require email verification to vote (default: true)
FRAUD_REQUIRE_EMAIL_VERIFIED=true

# Require phone verification to vote (default: true, STRONGLY RECOMMENDED)
FRAUD_REQUIRE_PHONE_VERIFIED=true

# Require BOTH email AND phone verified (default: true, STRONGEST PROTECTION)
# When enabled, users must have both verifications complete before voting
FRAUD_REQUIRE_BOTH_VERIFIED=true

# =============================================================================
# Fraud Detection Thresholds
# =============================================================================
# Risk score thresholds (0-100)
FRAUD_LOW_RISK_THRESHOLD=20
FRAUD_MEDIUM_RISK_THRESHOLD=50
FRAUD_HIGH_RISK_THRESHOLD=75
FRAUD_BLOCK_THRESHOLD=90

# Rate Limiting
FRAUD_MAX_VOTES_PER_MINUTE=5
FRAUD_MAX_VOTES_PER_HOUR=30
FRAUD_MAX_VOTES_PER_DAY=100

# Feature Flags
ENABLE_AI_POLL_GENERATION=true
ENABLE_GAMIFICATION=true

# Google AdSense (requires live site and approval)
# Apply at: https://www.google.com/adsense/
# Publisher ID format: pub-XXXXXXXXXXXXXXXX
ADSENSE_ENABLED=false
ADSENSE_PUBLISHER_ID=
ADSENSE_AD_SLOT_BANNER=
ADSENSE_AD_SLOT_SIDEBAR=
ADSENSE_AD_SLOT_INTERSTITIAL=
